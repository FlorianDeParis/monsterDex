<audio class="pokemonCry" autoplay #audioPlayer>
  @if (monsterDetails$ | async; as monsterDetails) {
    <source
      [src]="monsterDetails.cries.latest || monsterDetails.cries.legacy"
    />
  }
</audio>
<section class="monster-page">
  @if (monsterDetails$ | async; as monsterDetails) {
    <header class="py-16 {{setTypeClasses(monsterDetails.types)}}">
      <h1>{{ monsterDetails.name }}</h1>
      <div class="medalion">
        <img [src]="pokemonSelectedSprite" />
      </div>
    </header>

    @if (monsterDetails.stats) {
      Stats:
      @for (statGroup of monsterDetails.stats; track statGroup.stat.name) {
        <div>
          <p>{{ statGroup.stat.name }} : {{ statGroup.base_stat }}</p>
          <progress
            [id]="'stat_' + statGroup.stat.name"
            max="255"
            [value]="statGroup.base_stat"
          ></progress>
        </div>
      }
    }

    <app-world-map [pokemonGeneration]="idPokeGen" [pokemonId]="idMonster" />

    @if(pokemonEncountersList$ | async; as pokemonEncountersList){
      @if(pokemonEncountersList.length > 0){
      <table class="encounters">
        <thead>
          <tr>
            <td style="width:200px;">Lieu</td>
            <td style="width:100px;">Versions</td>
            <td>Types de recontres</td>
          </tr>
        </thead>
        <tbody>
          @for (encounter of pokemonEncountersList; track encounter.location_area.name){
            @for (encounterInGame of encounter.version_details; track encounterInGame.version.name){
              <tr>
                @if($first){
                  <td [attr.rowspan]="encounter.version_details.length > 0 ? encounter.version_details.length:null">
                    {{ encounter.location_area.name }}
                  </td>
                }
                <td class="game">
                  <span class="badge bg-{{encounterInGame.version.name}}">{{ encounterInGame.version.name | uppercase }}</span>
                </td>
                <td>
                  <table>
                    <thead>
                      <tr>
                        <td>Méthode:</td>
                        <td>Nv:</td>
                        <td>Chance:</td>
                      </tr>
                    </thead>
                    <tbody>
                      @for(encounter_detail of encounterInGame.encounter_details; track encounter_detail){
                        <tr>
                          <td><span class="sprite-tile" [attr.encounterMethodName]="encounter_detail.method.name"></span>{{ encounter_detail.method.name }}</td>
                          <td>{{ encounter_detail.min_level }}
                            @if( encounter_detail.min_level != encounter_detail.max_level){
                              -{{ encounter_detail.max_level }}
                            }
                          </td>
                          <td>{{encounter_detail.chance }}%</td>
                        </tr>
                      }
                    </tbody>
                  </table>
                </td>
              </tr>
            }
          }
        </tbody>
      </table>
      }
      @else {
        <p>Pas de données disponibles.</p>
      }
    } @else {
      <p>Chargement...</p>
    }

  }
</section>
